jQuery(function(e){function a(){var a=/^\d+$/,t=!0;e("#member-id").val().match(a)||(t=o({error:"Invalid member ID"})),t&&!e("#name").val()&&(t=o({error:"Invalid name"})),t&&!e("#email").val()&&(t=o({error:"Invalid email"})),t&&e.ajax(ajax_object.ajax_url,{data:{action:"join-challenge","chal-link":e("#chal-link").val(),"member-id":e("#member-id").val(),name:e("#name").val(),email:e("#email").val()},beforeSend:l,complete:r,success:function(e){o(e)&&(alert(e.success),e.redirect&&(location.href=ajax_object.chal_page+"/?chal="+id))},error:function(e,a,t){console.error(t)},dataType:"json",method:"post"}),dialog.dialog("close")}function t(){e("#msg").html("");var a=/^\d+$/;return e("#member-id").val()&&e("#member-id").val().match(a)?e("#email").val()?void e.ajax(ajax_object.ajax_url,{data:{action:"get-my-activity","member-id":e("#member-id").val(),email:e("#email").val(),"chal-id":e("#chal-id").val()},beforeSend:l,complete:r,success:function(a){o(a)&&(e("#total-points").html(a.total_points),e.fn.DataTable.isDataTable("#my-activity-table")&&(d.destroy(),e("#my-activity-table").empty()),d=e("#my-activity-table").DataTable({data:a.data.slice(0),columns:a.columns.slice(0),paging:!1,buttons:["copyHtml5","csv","excel","pdf","print"],dom:"Bfrtip",searching:!1}),e(".fa-trash-alt").click(n))},error:function(e,a,t){console.error(t)},method:"post",dataType:"json"}):(e("#msg").append("<div>Please enter your email</div>"),e("#msg").slideToggle(300),e("#msg").addClass("warn-msg"),setTimeout(function(){e("#msg").slideToggle(300)},5e3),!1):(e("#msg").append("<div>Please enter a valid member ID</div>"),e("#msg").slideToggle(300),e("#msg").addClass("warn-msg"),setTimeout(function(){e("#msg").slideToggle(300)},5e3),!1)}function i(){var a=e(this).parent().parent(),t=e(a).find(".type").val(),i="";if(s(a)){if("checkbox"==t){var n=e(a).find("input[type='checkbox']:checked").length;if(n>1){i=[];for(var o=0;o<n;o++)i.push(e(a).find("input[type='checkbox']:checked").eq(o).val())}else i=e(a).find("input[type='checkbox']:checked").val()}else i="radio"==t?e(a).find("input[type='radio']:checked").val():"long-text"==t?e(a).find("textarea").val():e(a).find("input.value").val();e.ajax(ajax_object.ajax_url,{data:{action:"save-entry","chal-link":e("#chal-link").val(),"act-id":e(a).find(".id").val(),type:t,value:i,"member-id":e("#member-id").val(),"user-name":e("#user-name").val(),"user-email":e("#user-email").val()},beforeSend:l,complete:r,success:function(t){e("#msg").empty(),e("#msg").removeClass("err-msg,warn-msg");var i=1500;t.error?(e("#msg").html("<p>"+t.error+"</p>"),e("#msg").addClass("err-msg"),i=5e3):t.warning?(e("#msg").html("<p>"+t.warning+"</p>"),e("#msg").addClass("warn-msg"),i=3e3):e("#msg").html("<p>Activity saved</p>"),e("#msg").css("top",e(a).position().top+5),e("#msg").height(e(a).height()+2),e("#msg").slideToggle(300),setTimeout(function(){e("#msg").slideToggle(300)},i)},error:function(e,a,t){console.error(t)},dataType:"json",method:"post"})}}function n(){var a=e(this);e.ajax(ajax_object.ajax_url,{data:{action:"delete-participant-activity","act-id":e(this).data("act-id"),"user-id":e(this).data("user-id"),"log-date":e(this).data("log-date"),security:e("#_wpnonce").val()},beforeSend:l,complete:r,success:function(t){o(t)&&d.row(e(a).closest("tr").index()).remove().draw()},error:function(e,a,t){console.error(t)},dataType:"json",method:"post"})}function s(a){var t=/^\d+$/,i=!0,n=e(a),s=e(a).find("input.type").val();if(e("#msg").empty(),e("#msg").removeClass("err-msg"),e("#msg").removeClass("warn-msg"),e("#msg").css("top",e(n).position().top+5),e("#msg").height(e(n).height()+2),e("#member-id").val()&&e("#member-id").val().match(t)||(e("#msg").append("<p>That is an invalid member ID</p>"),i=!1),e("#user-name").val()||(e("#msg").append("<p>You need to put your name in the form</p>"),i=!1),e("#user-email").val()||(e("#msg").append("<p>You need to enter your e-mail address</p>"),i=!1),"checkbox"==s||"radio"==s)e(a).find("input[type="+s+"]:checked").length||(e("#msg").append("<p>You must select one of the options</p>"),i=!1);else if("text"==s)e(a).find('input[type="text"]').val().length||(e("#msg").append("<p>Invalid entry for this activity</p>"),i=!1);else if("number"==s){var o=e(a).find('input[type="number"]'),l=e(o).val(),r=e(o).attr("min")?e(o).attr("min"):0,m=e(o).attr("max")?e(o).attr("max"):0;l.match(t)?parseInt(l)<1?(e("#msg").append("<p>Invalid entry for this activity, positive numbers only</p>"),i=!1):r>0&&parseInt(l)<r?(e("#msg").append("<p>Invalid entry for this activity, number must be greater than or equal to "+r+"</p>"),i=!1):m>0&&parseInt(l)>m&&(e("#msg").append("<p>Invalid entry for this activity, number must be lesser than or equal to "+m+"</p>"),i=!1):(e("#msg").append("<p>Invalid entry for this activity</p>"),i=!1)}return i||(e("#msg").slideToggle(300),e("#msg").addClass("warn-msg"),setTimeout(function(){e("#msg").slideToggle(300),e("#msg").empty()},5e3)),i}function o(a){e("#msg").empty(),e("#msg").removeClass("err-msg,warn-msg");var t=!1;return"0"==a?(e("#msg").html("<p>There was an error</p>"),e("#msg").addClass("err-msg"),t=!0):a.error?(e("#msg").html("<p>"+a.error+"</p>"),e("#msg").addClass("err-msg"),t=!0):a.warning?(e("#msg").html("<p>"+a.warning+"</p>"),e("#msg").addClass("warn-msg"),t=!0):a.success&&e("#msg").html("<p>"+a.success+"</p>"),e("#msg").html()&&e("#msg").show(300),t?setTimeout(function(){e("#msg").hide(300),e("#msg").empty()},3e3):setTimeout(function(){e("#msg").hide(300),e("#msg").empty()},1500),!t}function l(){e("#loading,#waiting").show(),e("#waiting").animate({opacity:"0.5"},300,"linear")}function r(){e("#loading,#waiting").hide(),e("#waiting").animate({opacity:"0"},300,"linear")}var m,d,c={lines:25,length:25,width:5,radius:50,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:.5,trail:60,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};e(".text-max").keyup(function(){e("#text-len-"+e(this).attr("id")).text(e(this).val().length)}),e("#registered-challenges,#upcoming-challenges,#past-challenges").DataTable({paging:!1,searching:!1}),e(".tooltip-field").tooltip({show:{effect:"slideDown",delay:100},hide:{effect:"slideUp",delay:250}}),dialog=e("#dialog-form").dialog({autoOpen:!1,height:500,width:350,modal:!0,buttons:{"Join Challenge":a,Cancel:function(){dialog.dialog("close")}},close:function(){form[0].reset()}}),form=dialog.find("form").on("submit",function(e){e.preventDefault(),a()}),e("#join-challenge").button().on("click",function(){dialog.dialog("open")}),e(".save").click(i),e("#get-activity").click(t),e("#msg").hide(),e("#loading")&&(m=document.getElementById("loading"),new Spinner(c).spin(m)),e("#my-activity-body tr").length&&(d=e("#my-activity-table").DataTable({paging:!1,buttons:["copyHtml5","csv","excel","pdf","print"],dom:"Bfrtip",searching:!1,stripClasses:["odd-row","even-row"],order:[[0,"asc"],[2,"asc"]]}),e(".fa-trash-alt").click(n))});