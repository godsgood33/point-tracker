jQuery(function(c){function h(){var n=/^\d+$/;var o=true;if(!c("#member-id").val().match(n)){o=d({error:"Invalid member ID"})}if(o&&!c("#name").val()){o=d({error:"Invalid name"})}if(o&&!c("#email").val()){o=d({error:"Invalid email"})}if(o){c.ajax(ajax_object.ajax_url,{data:{action:"join-challenge","chal-link":c("#chal-link").val(),"member-id":c("#member-id").val(),name:c("#name").val(),email:c("#email").val()},beforeSend:j,complete:l,success:function(p){if(!d(p)){return}alert(p.success);if(p.redirect){location.href=ajax_object.chal_page+"/?chal="+id}},error:function(r,p,q){console.error(q)},dataType:"json",method:"post"})}dialog.dialog("close")}function e(){c("#msg").html("");var n=/^\d+$/;if(!c("#member-id").val()||!c("#member-id").val().match(n)){c("#msg").append("<div>Please enter a valid member ID</div>");c("#msg").slideToggle(300);c("#msg").addClass("warn-msg");setTimeout(function(){c("#msg").slideToggle(300)},5000);return false}else{if(!c("#email").val()){c("#msg").append("<div>Please enter your email</div>");c("#msg").slideToggle(300);c("#msg").addClass("warn-msg");setTimeout(function(){c("#msg").slideToggle(300)},5000);return false}}c.ajax(ajax_object.ajax_url,{data:{action:"get-my-activity","member-id":c("#member-id").val(),email:c("#email").val(),"chal-id":c("#chal-id").val()},beforeSend:j,complete:l,success:function(o){if(!d(o)){return}c("#total-points").html(o.total_points);if(c.fn.DataTable.isDataTable("#my-activity-table")){k.destroy();c("#my-activity-table").empty()}k=c("#my-activity-table").DataTable({data:o.data.slice(0),columns:o.columns.slice(0),paging:false,buttons:["copyHtml5","csv","excel","pdf","print"],dom:"Bfrtip",searching:false});c(".fa-trash-alt").click(b)},error:function(q,o,p){console.error(p)},method:"post",dataType:"json"})}function g(){var r=c(this).parent().parent();var o=c(r).find(".type").val();var p="";if(!m(r)){return}if(o=="checkbox"){var q=c(r).find("input[type='checkbox']:checked").length;if(q>1){p=[];for(var n=0;n<q;n++){p.push(c(r).find("input[type='checkbox']:checked").eq(n).val())}}else{p=c(r).find("input[type='checkbox']:checked").val()}}else{if(o=="radio"){p=c(r).find("input[type='radio']:checked").val()}else{if(o=="long-text"){p=c(r).find("textarea").val()}else{p=c(r).find("input.value").val()}}}c.ajax(ajax_object.ajax_url,{data:{action:"save-entry","chal-link":c("#chal-link").val(),"act-id":c(r).find(".id").val(),type:o,value:p,"member-id":c("#member-id").val(),"user-name":c("#user-name").val(),"user-email":c("#user-email").val()},beforeSend:j,complete:l,success:function(s){c("#msg").empty();c("#msg").removeClass("err-msg,warn-msg");var t=1500;if(s.error){c("#msg").html("<p>"+s.error+"</p>");c("#msg").addClass("err-msg");t=5000}else{if(s.warning){c("#msg").html("<p>"+s.warning+"</p>");c("#msg").addClass("warn-msg");t=3000}else{c("#msg").html("<p>Activity saved</p>")}}c("#msg").css("top",c(r).position().top+5);c("#msg").height(c(r).height()+2);c("#msg").slideToggle(300);setTimeout(function(){c("#msg").slideToggle(300)},t)},error:function(u,s,t){console.error(t)},dataType:"json",method:"post"})}function b(){var n=c(this);c.ajax(ajax_object.ajax_url,{data:{action:"delete-participant-activity","act-id":c(this).data("act-id"),"user-id":c(this).data("user-id"),"log-date":c(this).data("log-date"),security:c("#_wpnonce").val()},beforeSend:j,complete:l,success:function(o){if(!d(o)){return}k.row(c(n).closest("tr").index()).remove().draw()},error:function(q,o,p){console.error(p)},dataType:"json",method:"post"})}function m(r){var v=/^\d+$/;var q=true;var n=c(r);var s=c(r).find("input.type").val();c("#msg").empty();c("#msg").removeClass("err-msg");c("#msg").removeClass("warn-msg");c("#msg").css("top",c(n).position().top+5);c("#msg").height(c(n).height()+2);if(!c("#member-id").val()||!c("#member-id").val().match(v)){c("#msg").append("<p>That is an invalid member ID</p>");q=false}if(!c("#user-name").val()){c("#msg").append("<p>You need to put your name in the form</p>");q=false}if(!c("#user-email").val()){c("#msg").append("<p>You need to enter your e-mail address</p>");q=false}if(s=="checkbox"||s=="radio"){if(!c(r).find("input[type="+s+"]:checked").length){c("#msg").append("<p>You must select one of the options</p>");q=false}}else{if(s=="text"){if(!c(r).find('input[type="text"]').val().length){c("#msg").append("<p>Invalid entry for this activity</p>");q=false}}else{if(s=="number"){var u=c(r).find('input[type="number"]');var p=c(u).val();var o=(c(u).attr("min")?c(u).attr("min"):0);var t=(c(u).attr("max")?c(u).attr("max"):0);if(!p.match(v)){c("#msg").append("<p>Invalid entry for this activity</p>");q=false}else{if(parseInt(p)<1){c("#msg").append("<p>Invalid entry for this activity, positive numbers only</p>");q=false}else{if(o>0&&parseInt(p)<o){c("#msg").append("<p>Invalid entry for this activity, number must be greater than or equal to "+o+"</p>");q=false}else{if(t>0&&parseInt(p)>t){c("#msg").append("<p>Invalid entry for this activity, number must be lesser than or equal to "+t+"</p>");q=false}}}}}}}if(!q){c("#msg").slideToggle(300);c("#msg").addClass("warn-msg");setTimeout(function(){c("#msg").slideToggle(300);c("#msg").empty()},5000)}return q}function d(o){c("#msg").empty();c("#msg").removeClass("err-msg,warn-msg");var n=false;if(o=="0"){c("#msg").html("<p>There was an error</p>");c("#msg").addClass("err-msg");n=true}else{if(o.error){c("#msg").html("<p>"+o.error+"</p>");c("#msg").addClass("err-msg");n=true}else{if(o.warning){c("#msg").html("<p>"+o.warning+"</p>");c("#msg").addClass("warn-msg");n=true}else{if(o.success){c("#msg").html("<p>"+o.success+"</p>")}}}}if(c("#msg").html()){c("#msg").show(300)}if(n){setTimeout(function(){c("#msg").hide(300);c("#msg").empty()},3000)}else{setTimeout(function(){c("#msg").hide(300);c("#msg").empty()},1500)}return !n}function j(){c("#loading,#waiting").show();c("#waiting").animate({opacity:"0.5"},300,"linear")}function l(){c("#loading,#waiting").hide();c("#waiting").animate({opacity:"0"},300,"linear")}var a={lines:25,length:25,width:5,radius:50,scale:1,corners:1,color:"#000",opacity:0.25,rotate:0,direction:1,speed:0.5,trail:60,fps:20,zIndex:2000000000,className:"spinner",top:"50%",left:"50%",shadow:false,hwaccel:false,position:"absolute"};var f,i,k;c(".text-max").keyup(function(){c("#text-len-"+c(this).attr("id")).text(c(this).val().length)});c("#registered-challenges,#upcoming-challenges,#past-challenges").DataTable({paging:false,searching:false});c(".tooltip-field").tooltip({show:{effect:"slideDown",delay:100},hide:{effect:"slideUp",delay:250}});dialog=c("#dialog-form").dialog({autoOpen:false,height:500,width:350,modal:true,buttons:{"Join Challenge":h,Cancel:function(){dialog.dialog("close")}},close:function(){form[0].reset()}});form=dialog.find("form").on("submit",function(n){n.preventDefault();h()});c("#join-challenge").button().on("click",function(){dialog.dialog("open")});c(".save").click(g);c("#get-activity").click(e);c("#msg").hide();if(c("#loading")){f=document.getElementById("loading");i=new Spinner(a).spin(f)}if(c("#my-activity-body tr").length){k=c("#my-activity-table").DataTable({paging:false,buttons:["copyHtml5","csv","excel","pdf","print"],dom:"Bfrtip",searching:false,stripClasses:["odd-row","even-row"],order:[[0,"asc"],[2,"asc"]]});c(".fa-trash-alt").click(b)}});